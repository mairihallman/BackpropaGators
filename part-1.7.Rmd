---
title: "Part 1.7"
author: "Mairi Hallman"
date: "2024-04-03"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(reticulate)
use_condaenv("4373-project",require=TRUE)
```

```{python}
from tensorflow.config.experimental import enable_op_determinism
from tensorflow.keras.datasets import mnist
from tensorflow.keras.layers import Dense, Flatten, Input
from tensorflow.keras.losses import SparseCategoricalCrossentropy
from tensorflow.keras.models import Model
from tensorflow.keras.utils import set_random_seed
```

```{python}
enable_op_determinism()
set_random_seed(1)
```
```{python}
# load dataset
(x_train, y_train), (x_test, y_test) = mnist.load_data()
x_train, x_test = x_train / 255.0, x_test / 255.0

```
```{python}
def my_model(shape, n, classes, x_train, y_train):
    """
    Initializes, compiles, and fits a model.
    
    Parameters:
    - shape: tuple, the shape of the input images ((28,28) for minst)
    - n: int, the number of nodes in the hidden layer
    - classes: int, the number of classes (10 for minst)
    - x_train: numpy.ndarray
    - y_train: numpy.ndarray
      
    Returns:
    - The fitted model.
    """
    
    # initialize model
    inputs = Input(shape=shape)
    x = Flatten()(inputs)
    x = Dense(n, activation="tanh")(x)
    outputs = Dense(classes)(x)
    
    model = Model(inputs=inputs, outputs=outputs)
    
    # compile model
    model.compile(optimizer="adam",
                  loss=SparseCategoricalCrossentropy(from_logits=True), # from_logits=True applies softmax to loss
                  metrics=["accuracy"]
                 )

    # fit model
    model.fit(x_train, y_train)
    
    return model
```
```{python}
model_0 = my_model((28,28),300,10,x_train,y_train)
```
```{python}
test_loss_0, test_acc_0 = model_0.evaluate(x_test, y_test)
```